import{u as F,B as k,I,b as N,F as r,a as j,M as w,v as D,c as E,h as d}from"./index.0aed31ab.js";import{bA as f,bE as M,bV as q,bU as L,bx as p,bF as e,bR as m}from"./vendor.06ae5aee.js";import"./vant.d56216df.js";const O="_logo_1rfy5_1",R="_icon_1rfy5_8",T="_appName_1rfy5_12",u={logo:O,icon:R,appName:T},U=c=>{const t=f(c);return{ref:t,toggle:()=>t.value=!t.value,on:()=>t.value=!0,off:()=>t.value=!1}},H=M({props:{name:{type:String}},setup:(c,t)=>{const g=F(),{refreshMe:b}=g,y=q(),v=L(),a=p({email:"",code:""}),s=p({email:[],code:[]}),_=async o=>{var n;if(o.preventDefault(),Object.assign(s,{email:[],code:[]}),Object.assign(s,D(a,[{key:"email",type:"required",message:"\u5FC5\u586B"},{key:"email",type:"pattern",regex:/.+@.+/,message:"\u5FC5\u987B\u662F\u90AE\u7BB1\u5730\u5740"},{key:"code",type:"required",message:"\u5FC5\u586B"}])),!E(s)){const l=await d.post("/session",a,{_autoLoading:!0});localStorage.setItem("jwt",l.data.jwt);const C=(n=v.query.return_to)==null?void 0:n.toString();b(),y.push(C||"/")}},i=f(),{ref:h,toggle:A,on:S,off:V}=U(!1),B=o=>{throw o.response.status===422&&Object.assign(s,o.response.data.errors),o},x=async()=>{S(),await d.post("/validation_codes",{email:a.email},{_autoLoading:!0}).catch(B).finally(V),i.value.startCount()};return()=>e(w,null,{title:()=>"\u767B\u5F55",icon:()=>e(k,null,null),default:()=>e("div",null,[e("div",{class:u.logo},[e(I,{name:"mangosteen",class:u.icon},null),e("p",{class:u.appName},[m("\u70B9\u6EF4\u8BB0\u8D26")])]),e(N,{onSubmit:_},{default:()=>{var o,n;return[e(r,{label:"\u90AE\u7BB1\u5730\u5740",type:"text",modelValue:a.email,"onUpdate:modelValue":l=>a.email=l,placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1\uFF0C\u7136\u540E\u70B9\u51FB\u53D1\u9001\u9A8C\u8BC1",error:(o=s.email)==null?void 0:o[0]},null),e(r,{label:"\u9A8C\u8BC1\u7801",type:"validationCode",modelValue:a.code,"onUpdate:modelValue":l=>a.code=l,placeholder:"\u516D\u4F4D\u6570",onClick:x,countFrom:60,disabled:h.value,ref:i,error:(n=s.code)==null?void 0:n[0]},null),e(r,{style:{paddingTop:"96px"}},{default:()=>[e(j,{type:"submit"},{default:()=>[m("\u767B\u5F55")]})]})]}})])})}});export{H as SignInPage,H as default};
