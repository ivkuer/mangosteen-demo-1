import{u as B,B as F,I as N,F as k,a as r,b as I,M as j,v as D,h as M,c as d}from"./index.b5817994.js";import{bA as f,bE as O,bx as p,bF as e,bV as q,bU as E,bR as m}from"./vendor.6d54b9a4.js";import"./vant.4ec2560f.js";const L="_logo_1yidw_1",R="_icon_1yidw_8",T="_appName_1yidw_12",i={logo:L,icon:R,appName:T},U=u=>{const t=f(u);return{ref:t,toggle:()=>t.value=!t.value,on:()=>t.value=!0,off:()=>t.value=!1}},G=O({props:{name:{type:String}},setup:(u,t)=>{const g=B(),{refreshMe:y}=g,b=q(),v=E(),o=p({email:"",code:""}),s=p({email:[],code:[]}),_=async a=>{var n;if(a.preventDefault(),Object.assign(s,{email:[],code:[]}),Object.assign(s,D(o,[{key:"email",type:"required",message:"\u5FC5\u586B"},{key:"email",type:"pattern",regex:/.+@.+/,message:"\u5FC5\u987B\u662F\u90AE\u7BB1\u5730\u5740"},{key:"code",type:"required",message:"\u5FC5\u586B"}])),!M(s)){const l=await d.post("/session",o,{_autoLoading:!0});localStorage.setItem("jwt",l.data.jwt);const x=(n=v.query.return_to)==null?void 0:n.toString();y(),b.push(x||"/")}},c=f(),{ref:S,toggle:A,on:h,off:V}=U(!1),w=a=>{throw a.response.status===422&&Object.assign(s,a.response.data.errors),a},C=async()=>{h(),await d.post("/validation_codes",{email:o.email},{_autoLoading:!0}).catch(w).finally(V),c.value.startCount()};return()=>e(j,null,{title:()=>"\u767B\u5F55",icon:()=>e(F,null,null),default:()=>e("div",null,[e("div",{class:i.logo},[e(N,{name:"mangosteen",class:i.icon},null),e("p",{class:i.appName},[m("\u5C71\u7AF9\u8BB0\u8D26")])]),e("div",null,[JSON.stringify(o)]),e(k,{onSubmit:_},{default:()=>{var a,n;return[e(r,{label:"\u90AE\u7BB1\u5730\u5740",type:"text",modelValue:o.email,"onUpdate:modelValue":l=>o.email=l,placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1\uFF0C\u7136\u540E\u70B9\u51FB\u53D1\u9001\u9A8C\u8BC1",error:(a=s.email)==null?void 0:a[0]},null),e(r,{label:"\u9A8C\u8BC1\u7801",type:"validationCode",modelValue:o.code,"onUpdate:modelValue":l=>o.code=l,placeholder:"\u516D\u4F4D\u6570",onClick:C,countFrom:60,disabled:S.value,ref:c,error:(n=s.code)==null?void 0:n[0]},null),e(r,{style:{paddingTop:"96px"}},{default:()=>[e(I,{type:"submit"},{default:()=>[m("\u767B\u5F55")]})]})]}})])})}});export{G as SignInPage,G as default};
